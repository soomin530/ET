<!DOCTYPE html>
<html lang="ko">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>í‹°ì¼“íŒ… ì‹œìŠ¤í…œ</title>
	<link rel="stylesheet" href="/css/main-style.css">

	<th:block th:replace="~{common/common}"></th:block>
</head>

<body>

	<th:block th:replace="~{common/header}"></th:block>

	<!-- hero ì„¹ì…˜ ë°”ë¡œ ë‹¤ìŒì— ì¶”ê°€ -->
	<div class="ticker-wrap">
		<div class="ticker">
			<!-- íƒ€ì„ë¦¬í”„ë¡œ performanceRankingì„ ë°˜ë³µ -->
			<div th:each="ranking, iterStat : ${performanceRanking}">
				<div class="ticker-item">
					<!-- í´ë¦­ ì‹œ í•´ë‹¹ MT20IDë¡œ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™ -->
					<a th:href="@{/performance/detail/{mt20id}(mt20id=${ranking.mt20id})}" class="ticker-link">
						ğŸŸï¸ <span th:text="${iterStat.index + 1}">1</span>ìœ„:
						<span th:text="${ranking.prfnm}">ê³µì—° ì œëª©</span>
						(í‰ì : <span th:text="${ranking.avgRating}">í‰ì </span>â­)
					</a>
				</div>
			</div>
		</div>
	</div>

	<div class="section visible" id="hero">
		<div class="hero">
			<h1>ë‹¹ì‹ ì˜ ê¿ˆì˜ ê³µì—°ì„ ì°¾ì•„ë³´ì„¸ìš”!</h1>
		</div>
	</div>

	<!-- ì¼€ëŸ¬ì…€ HTML ë¶€ë¶„ -->
	<div class="section carousel-section" id="performances-carousel">
		<div class="section-header">
			<h2 class="main-title">ì£¼ìš” ê³µì—° ì†Œê°œ</h2>
			<h3 class="current-performance" th:text="${mainPerform[0].prfnm}">ê³µì—° ì œëª©</h3>
		</div>
		<div class="custom-carousel">
			<div class="carousel-container">
				<th:block th:each="mainPerform, status : ${mainPerform}">
					<div class="carousel-slide" th:classappend="${status.first ? 'active' : ''}"
						th:data-title="${mainPerform.prfnm}"
						th:data-link="@{/performance/detail/{mt20id}(mt20id=${mainPerform.mt20id})}">
						<div class="carousel-image">
							<img th:src="${mainPerform.poster}" alt="ê³µì—° ì´ë¯¸ì§€" loading="lazy">
						</div>
					</div>
				</th:block>
				<button class="carousel-arrow prev-arrow">&#10094;</button>
				<button class="carousel-arrow next-arrow">&#10095;</button>
			</div>
			<div class="carousel-bottom">
				<a th:href="@{/performance/detail/{mt20id}(mt20id=${mainPerform[0].mt20id})}" class="carousel-btn"
					style="cursor: pointer;">ìì„¸íˆ ë³´ê¸°</a>
				<div class="carousel-indicators">
					<!-- ì¸ë””ì¼€ì´í„°ëŠ” JavaScriptì—ì„œ ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
				</div>
			</div>
		</div>
	</div>

	<!-- carousel-section ë‹¤ìŒì— ì¶”ê°€ -->
	<div class="section statistics-section" id="performance-stats">
		<div class="section-header">
			<h2 class="main-title">ê³µì—° í†µê³„</h2>
		</div>

		<!-- ê³µì—° í†µê³„ í…Œì´ë¸” -->
		<div class="table-container">
			<!-- í†µê³„ ì°¨íŠ¸ -->
			<div class="chart-container">
				<canvas id="concertChart"></canvas>
			</div>

			<div class="table-scroll">
				<table>
					<thead>
						<tr>
							<th>ì¹´í…Œê³ ë¦¬</th>
							<th>ê³µì—° ìˆ˜</th>
							<th>ê³µì—°ì¼ ìˆ˜</th>
							<th>ì˜ˆë§¤ ìˆ˜</th>
							<th>ì·¨ì†Œ ì˜ˆë§¤ ìˆ˜</th>
							<th>ì´ ì˜ˆë§¤ ìˆ˜</th>
							<th>ì´ ì˜ˆë§¤ ê¸ˆì•¡</th>
						</tr>
					</thead>
					<tbody>
						<!-- ì—°ê·¹ ë°ì´í„° -->
						<tr>
							<td>ì—°ê·¹</td>
							<td>422</td>
							<td>6305</td>
							<td>192932</td>
							<td>69216</td>
							<td>123716</td>
							<td>3,278,347,195</td>
						</tr>
						<!-- ì„œì–‘ìŒì•…(í´ë˜ì‹) ë°ì´í„° -->
						<tr>
							<td>ì„œì–‘ìŒì•…(í´ë˜ì‹)</td>
							<td>1054</td>
							<td>1325</td>
							<td>201572</td>
							<td>60655</td>
							<td>140917</td>
							<td>3,516,942,954</td>
						</tr>
						<!-- ë®¤ì§€ì»¬ ë°ì´í„° -->
						<tr>
							<td>ë®¤ì§€ì»¬</td>
							<td>668</td>
							<td>7228</td>
							<td>766050</td>
							<td>357941</td>
							<td>408109</td>
							<td>28,605,122,773</td>
						</tr>
						<!-- í•©ê³„ ë°ì´í„° -->
						<tr>
							<td>í•©ê³„</td>
							<td>2144</td>
							<td>14858</td>
							<td>1160554</td>
							<td>487812</td>
							<td>672742</td>
							<td>35,399,462,922</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</div>
	
	<!-- ê³µì§€ì‚¬í•­ ì˜ì—­ -->
	<div>
		
	</div>

	<!-- common/footer ì¶”ê°€-->
	<th:block th:replace="~{common/footer}"></th:block>


	<!-- Chart.js ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€ -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"></script>

	<script>
		// ìºëŸ¬ì…€ í´ë˜ìŠ¤ ì¶”ê°€
		class Carousel {
			constructor() {
				this.carousel = document.querySelector('.custom-carousel');
				this.slides = Array.from(this.carousel.querySelectorAll('.carousel-slide'));
				this.totalSlides = this.slides.length;
				this.currentSlide = 0;
				this.autoPlayInterval = null;
				this.performanceTitle = document.querySelector('.current-performance');
				this.titles = this.slides.map(slide => slide.dataset.title);
				this.detailLinks = Array.from(this.carousel.querySelectorAll('[data-link]'))
					.map(el => el.dataset.link);
				this.detailButton = this.carousel.querySelector('.carousel-btn');

				this.initializeCarousel();
				this.addEventListeners();
				this.startAutoPlay();
			}

			initializeCarousel() {
				// ì¸ë””ì¼€ì´í„° ìƒì„±
				const indicatorsContainer = this.carousel.querySelector('.carousel-indicators');
				indicatorsContainer.innerHTML = ''; // ê¸°ì¡´ ì¸ë””ì¼€ì´í„° ì´ˆê¸°í™”

				for (let i = 0; i < this.totalSlides; i++) {
					const indicator = document.createElement('div');
					indicator.className = `indicator ${i === 0 ? 'active' : ''}`;
					indicator.addEventListener('click', () => this.goToSlide(i));
					indicatorsContainer.appendChild(indicator);
				}

				// ì¸ë””ì¼€ì´í„° ìš”ì†Œë“¤ì„ ì €ì¥
				this.indicators = Array.from(indicatorsContainer.querySelectorAll('.indicator'));
			}

			addEventListeners() {
				this.carousel.addEventListener('mouseenter', () => this.stopAutoPlay());
				this.carousel.addEventListener('mouseleave', () => this.startAutoPlay());

				this.carousel.querySelector('.prev-arrow').addEventListener('click', () => {
					this.prevSlide();
					this.resetAutoPlay();
				});

				this.carousel.querySelector('.next-arrow').addEventListener('click', () => {
					this.nextSlide();
					this.resetAutoPlay();
				});
			}

			updateSlides() {
				const activeSlide = this.slides[this.currentSlide];
				document.querySelector('.carousel-slide.active').classList.remove('active');
				activeSlide.classList.add('active');

				this.performanceTitle.textContent = activeSlide.dataset.title;

				// href ì†ì„± ì§ì ‘ ë³€ê²½
				this.detailButton.href = activeSlide.dataset.link;

				this.indicators.forEach((indicator, index) => {
					if (index === this.currentSlide) {
						indicator.classList.add('active');
					} else {
						indicator.classList.remove('active');
					}
				});
			}

			nextSlide() {
				this.currentSlide = (this.currentSlide + 1) % this.totalSlides;
				this.updateSlides();
			}

			prevSlide() {
				this.currentSlide = (this.currentSlide - 1 + this.totalSlides) % this.totalSlides;
				this.updateSlides();
			}

			goToSlide(index) {
				this.currentSlide = index;
				this.updateSlides();
				this.resetAutoPlay();
			}

			startAutoPlay() {
				this.autoPlayInterval = setInterval(() => this.nextSlide(), 5000);
			}

			stopAutoPlay() {
				if (this.autoPlayInterval) {
					clearInterval(this.autoPlayInterval);
					this.autoPlayInterval = null;
				}
			}

			resetAutoPlay() {
				this.stopAutoPlay();
				this.startAutoPlay();
			}
		}

		document.addEventListener('DOMContentLoaded', function () {
			// ìºëŸ¬ì…€ ì´ˆê¸°í™”
			new Carousel();

			// ì°¨íŠ¸ ì´ˆê¸°í™”
			const ctx = document.getElementById('concertChart').getContext('2d');
			new Chart(ctx, {
				type: 'bar',  // ë°” ì°¨íŠ¸
				data: {
					labels: ['ì—°ê·¹', 'ì„œì–‘ìŒì•…(í´ë˜ì‹)', 'ë®¤ì§€ì»¬', 'í•©ê³„'],  // ì¹´í…Œê³ ë¦¬
					datasets: [{
						label: 'ì˜ˆë§¤ ìˆ˜',
						data: [192932, 201572, 766050, 672742],  // ì˜ˆë§¤ ìˆ˜
						backgroundColor: 'rgba(75, 192, 192, 0.2)',
						borderColor: 'rgba(75, 192, 192, 1)',
						borderWidth: 1
					}, {
						label: 'ì·¨ì†Œ ì˜ˆë§¤ ìˆ˜',
						data: [69216, 60655, 357941, 487812],  // ì·¨ì†Œ ì˜ˆë§¤ ìˆ˜
						backgroundColor: 'rgba(255, 99, 132, 0.2)',
						borderColor: 'rgba(255, 99, 132, 1)',
						borderWidth: 1
					}]
				},
				options: {
					scales: {
						y: {
							beginAtZero: true
						}
					},
					responsive: true,
					plugins: {
						legend: {
							position: 'top',
						}
					}
				}
			});

		});

		const sections = document.querySelectorAll('.section');

		const options = {
			root: null,
			rootMargin: '0px',
			threshold: 0.1
		};

		const observer = new IntersectionObserver((entries) => {
			entries.forEach(entry => {
				if (entry.isIntersecting) {
					entry.target.classList.add('visible');
				} else {
					entry.target.classList.remove('visible');
				}
			});
		}, options);

		sections.forEach(section => {
			observer.observe(section);
		});

		function scrollToSection(sectionId) {
			const section = document.getElementById(sectionId);
			section.scrollIntoView({behavior: 'smooth'});
		}

	</script>

	<script src="/js/main.js"></script>

</body>

</html>